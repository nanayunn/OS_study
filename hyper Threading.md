Intel의 하이퍼 스레딩 기술은 Intel 아키텍처에 동시 멀티 스레딩 개념을 도입합니다.  Hyper-Threading Technology는 하나의 물리적 프로세서가 두 개의 논리 프로세서로 나타나도록 합니다. 즉, 물리적 실행 리소스가 공유되고 두 개의 논리 프로세서에 대해 아키텍처 상태가 중복됩니다.  소프트웨어 또는 아키텍처의 관점에서, 이는 운영 체제와 사용자 프로그램이 여러 물리적 프로세서에서처럼 논리 프로세서에 대한 프로세스 또는 스레드를 예약할 수 있음을 의미합니다.  마이크로아키텍처 관점에서, 이는 두 논리 프로세서의 지침이 공유 실행 리소스에서 유지되고 동시에 실행된다는 것을 의미합니다.  
이 백서에서는 Hyper-Threading Technology 아키텍처에 대해 설명하고 Intel의 Xeon processor 프로세서 제품군에서 Intel의 첫 번째 구현에 대한 마이크로아키텍처 세부 사항에 대해 설명합니다.  하이퍼스레딩 기술은 Intel의 엔터프라이즈 제품군에 중요한 추가 요소이며 다양한 제품에 통합될 것입니다.



***

인터넷과 통신의 놀라운 성장은 점점 더 높은 수준의 프로세서 성능을 요구하는 더욱 빠른 시스템에 의해 구동됩니다.  이러한 요구를 충족시키기 위해 우리는 기존의 프로세서 설계 방식에 전적으로 의존할 수는 없습니다.  과거 프로세서 성능 향상을 달성하기 위해 사용되는 마이크로아키텍처 기술(슈퍼파이프라인, 분기 예측, 슈퍼스케일러 실행, 주문 외 실행, 캐시)은 마이크로프로세서를 점점 더 복잡하게 만들고 트랜지스터를 더 많이 사용하며 전력을 더 많이 소비하게 만들었습니다.  실제로 트랜지스터 수와 전력은 프로세서 성능보다 더 큰 속도로 증가하고 있습니다.  따라서 프로세서 설계자는 트랜지스터 수나 전력 소산보다 더 빠른 속도로 성능을 개선할 방법을 찾고 있습니다.  인텔의 하이퍼 스레딩 기술은 하나의 솔루션입니다.

***

process



프로세서 설계에 대한 기존의 접근 방식은 더 높은 클럭 속도, ILP(지침 수준 병렬 처리) 및 캐시에 초점을 맞췄습니다.  더 높은 클럭 속도를 달성하기 위한 기술에는 마이크로아키텍처를 보다 미세한 세분성으로 파이프라인하는 것(슈퍼파이프라인이라고도 함)이 포함됩니다.  클럭 주파수가 높을수록 초당 실행할 수 있는 명령의 수가 증가하여 성능이 크게 향상될 수 있습니다.  슈퍼파이프라인 마이크로아키텍처에는 훨씬 더 많은 지침이 제공되기 때문에, 캐쉬 누락, 인터럽트 및 분기 오류와 같은 파이프라인을 방해하는 이벤트를 처리하는 데 많은 비용이 소요될 수 있습니다.

ILP는 각 클럭 사이클마다 실행되는 명령의 수를 증가시키는 기법을 말합니다.  예를 들어, 수퍼 스칼라 프로세서에는 명령을 동시에 처리할 수 있는 여러 개의 병렬 실행 장치가 있습니다.  슈퍼 스칼라 실행을 사용하면 각 클럭 사이클마다 여러 지침을 실행할 수 있습니다.  그러나 단순한 주문형 실행으로는 단순히 실행 단위를 여러 개 갖는 것만으로는 충분하지 않습니다.  실행 가능한 지침을 충분히 찾는 것이 과제입니다.  한 가지 기법은 프로그램 순서가 아닌 명령 종속성에 따라 대규모 명령 창을 동시에 평가하여 실행 단위로 보내는 비순서 실행입니다. 
DRAM 메모리에 대한 액세스는 프로세서의 실행 속도에 비해 느립니다.  이 지연 시간을 줄이는 한 가지 방법은 프로세서에 가까운 고속 캐시를 추가하는 것입니다.  캐시는 자주 액세스하는 데이터 또는 지침에 대한 빠른 메모리 액세스를 제공할 수 있습니다.  하지만, 캐시는 작을 때만 빠를 수 있습니다.  이러한 이유로 프로세서는 종종 프로세서 코어에 매우 가까운 액세스 대기 시간에 빠르고 작은 캐시가 배치되고 작동되는 캐시 계층 구조로 설계되며, 자주 액세스하지 않는 데이터나 지침을 처리하는 점차적으로 더 큰 캐시가 더 긴 액세스 대기 시간으로 구현됩니다.  그러나 필요한 데이터가 프로세서 캐시에 저장되지 않는 경우가 항상 있습니다.  이러한 캐시 누락을 처리하려면 메모리에 액세스해야 하며, 프로세서에 캐시 누락을 대기 전에 실행할 지침이 빠르게 부족할 수 있습니다. 
프로세서 성능을 한 세대에서 다음 세대로 향상시키기 위한 대다수의 기술은 복잡하며 종종 다이 크기 및 전력 비용을 크게 증가시킵니다.  이러한 기술은 성능을 향상시키지만 100% 효율성은 제공하지 않습니다. 즉, 프로세서에서 실행 단위의 수를 두 배로 늘리면 명령 흐름에서 제한된 병렬 처리로 인해 프로세서의 성능이 두 배로 향상되지 않습니다.  마찬가지로 클럭 속도를 두 배로 높이는 것만으로는 분기 오측으로 손실된 프로세서 주기 수 때문에 성능이 두 배로 향상되지 않습니다.

***

그림 1은 Intel 프로세서1에서 지난 10년간 성능의 상대적 증가와 다이 크기 및 전력과 같은 비용을 보여줍니다.  이 비교에서는 마이크로아키텍처 영향을 분리하기 위해 4세대 프로세서가 동일한 실리콘 프로세스 기술을 기반으로 하고 있으며 속도 업이 Intel486 processor 프로세서의 성능에 맞춰 정규화된다고 가정합니다.  이 예에서는 Intel의 프로세서 기록을 사용하지만 이 기간 동안 다른 고성능 프로세서 제조업체도 비슷한 경향을 보일 수 있습니다.  마이크로아키텍처 발전만으로 인해 Intel의 프로세서 성능은 정수 성능을 5배 또는 6배 향상했습니다.  대부분의 정수 응용프로그램은 ILP가 제한되어 있으며 명령 흐름을 예측하기 어려울 수 있습니다.  
같은 기간 상대적 다이 크기는 정수 성능의 상승보다 3배 높은 15배 증가했습니다.  다행히도, 실리콘 공정 기술의 발전으로 인해 더 많은 트랜지스터를 주어진 다이 영역으로 포장할 수 있게 되어 각 세대의 마이크로아키텍처에서의 실제 측정된 다이 사이즈가 크게 증가하지 않았습니다. 
이 기간 동안 상대적 힘은 거의 18배 증가했습니다1.  다행히도 프로세서의 전력 소비량을 크게 줄일 수 있는 여러 가지 알려진 기술이 존재하며, 이 분야에서 많은 연구가 진행 중입니다.  그러나 현재 프로세서 전력 소산은 데스크톱 플랫폼에서 쉽게 처리할 수 있는 한계에 있으며, 특히 전력 제어를 위해 신기술과 함께 성능 향상에 더욱 중점을 두어야 합니다.

이러한 데이터는 근사치이며 실제 성능이 아닌 추세를 보여주기 위한 것입니다. 

 Intel486은 미국 및 기타 국가에서 Intel Corporation 또는 해당 자회사의 상표입니다.

***

스레드 레벨 병렬 처리

오늘날의 소프트웨어 동향을 보면 서버 응용프로그램이 병렬로 실행될 수 있는 여러 스레드 또는 프로세스로 구성되어 있음을 알 수 있습니다.  온라인 트랜잭션 처리 및 웹 서비스에는 성능을 향상시키기 위해 동시에 실행할 수 있는 소프트웨어 스레드가 풍부합니다.  심지어 데스크톱 애플리케이션도 점점 더 병렬화되고 있습니다.  인텔의 건축가들은 트랜지스터 개수와 전력 비율에 비해 더 나은 성능을 얻기 위해 소위 스레드 레벨 병렬(TLP)을 활용하려고 노력해 왔습니다.   
하이엔드 및 미드레인지 서버 시장 모두에서 멀티프로세서는 시스템으로부터 더 높은 성능을 얻기 위해 일반적으로 사용되어 왔습니다.  프로세서를 더 추가하면 여러 프로세서에서 동시에 여러 스레드를 실행함으로써 잠재적으로 애플리케이션의 성능이 크게 향상됩니다.  이러한 스레드는 동일한 애플리케이션, 동시에 실행되는 여러 애플리케이션, 운영 체제 서비스 또는 백그라운드 유지 보수를 수행하는 운영 체제 스레드에서 가져올 수 있습니다.  멀티프로세서 시스템은 여러 해 동안 사용되어 왔으며, 고성능 프로그래머들은 고성능을 위해 멀티프로세서를 활용하는 기술에 익숙합니다.   
최근 몇 년 동안 TLP를 더욱 활용하기 위한 여러 가지 다른 기법이 논의되었으며 일부 제품이 발표되었습니다.  이러한 기술 중 하나는 CMP(Chip Multiprocessing)로, 두 개의 프로세서가 단일 다이 위에 배치됩니다.  두 프로세서는 각각 실행 및 아키텍처 리소스의 전체 집합을 가집니다.  프로세서가 대용량 온칩 캐시를 공유하거나 공유하지 않을 수 있습니다.  
CMP는 멀티프로세서 구성에서 여러 CMP 프로세서를 사용할 수 있기 때문에 기존 멀티프로세서 시스템과 거의 직교합니다.  최근에 발표된 프로세서는 각 다이마다 두 개의 프로세서를 통합합니다.  그러나 CMP 칩은 단일 코어 칩의 크기보다 훨씬 크기 때문에 제조 비용이 더 많이 듭니다. 더욱이 다이 크기와 전력 고려 사항을 다루기 시작하지는 않습니다. 
또 다른 방법은 단일 프로세서가 여러 스레드를 전환하여 실행할 수 있도록 하는 것입니다.  시간 간격 다중 스레딩은 프로세서가 정해진 시간 후에 소프트웨어 스레드 간에 전환되는 위치입니다.  시간 간격 다중 스레딩은 실행 슬롯을 낭비할 수 있지만 메모리에 대한 긴 지연의 영향을 효과적으로 최소화할 수 있습니다.  Switch-on-event 멀티스레딩은 캐시 누락과 같은 긴 대기 시간 이벤트의 스레드를 전환합니다.  이 접근 방식은 캐시 누락이 많은 서버 응용프로그램과 두 스레드가 유사한 태스크를 실행하는 서버 응용프로그램에 적합합니다.  그러나 시간 경과 및 스위치 원벤트 다중 스레딩 기법 모두 분기 오예측, 명령 종속성 등과 같이 비효율적인 리소스 사용의 많은 소스에서 최적의 중복을 얻지 못합니다. 
마지막으로, 여러 개의 스레드가 단일 프로세서에서 전환 없이 실행될 수 있는 동시 멀티스레딩이 있습니다.  스레드는 동시에 실행되며 리소스를 훨씬 더 효율적으로 사용합니다.  이 접근 방식은 프로세서 리소스를 가장 효과적으로 사용할 수 있습니다. 트랜지스터 수 및 전력 소비량 대비 성능을 최대화합니다. 

하이퍼 스레딩 기술은 Intel 아키텍처에 멀티 스레딩 접근 방식을 동시에 제공합니다.  이 백서에서는 Intelligent Xeon processor 프로세서 제품군에 대한 하이퍼 스레딩 기술의 아키텍처와 첫 번째 구현에 대해 설명합니다.

***

하이퍼스레딩 기술 아키텍처입니다.



하이퍼 스레딩 기술은 단일 물리적 프로세서를 여러 논리 프로세서로 나타내도록 합니다 [11, 12].  이를 위해 각 논리 프로세서에 대해 아키텍처 상태의 복사본이 하나씩 있으며, 논리 프로세서는 단일 물리적 실행 리소스 집합을 공유합니다.  소프트웨어 또는 아키텍처의 관점에서, 이는 운영 체제와 사용자 프로그램이 멀티프로세서 시스템의 기존 물리적 프로세서에서와 마찬가지로 프로세스 또는 스레드를 논리 프로세서로 스케줄링할 수 있음을 의미합니다.  마이크로아키텍처 관점에서 볼 때, 이는 논리적 프로세서의 지침이 공유 실행 리소스에서 유지되고 동시에 실행된다는 것을 의미합니다.

Intel은 미국 및 기타 국가에서 Intel Corporation 또는 해당 자회사의 등록 상표입니다. 

Xeon은 미국 및 기타 국가에서 Intel Corporation 또는 해당 자회사의 상표입니다.  
예를 들어 그림 2는 하이퍼가 아닌 두 개의 물리적 프로세서가 있는 멀티프로세서 시스템을 보여줍니다.스레딩 기술을 사용할 수 있습니다.  그림 3은 하이퍼 스레딩 기술이 가능한 두 개의 물리적 프로세서가 장착된 멀티프로세서 시스템을 보여줍니다.  각 물리적 프로세서에 두 개의 아키텍처 상태 복사본이 있는 시스템에는 네 개의 논리 프로세서가 있는 것으로 보입니다.

최초의 Hyper-Threading 기술 구현은 듀얼 및 멀티프로세서 서버용 Intel Xeoneon 프로세서 제품군에서 물리적 프로세서당 2개의 논리 프로세서를 사용하여 제공되고 있습니다.  기존 프로세서 리소스를 보다 효율적으로 사용함으로써 Intel Xeon 프로세서 제품군은 거의 동일한 시스템 비용으로 성능을 크게 향상시킬 수 있습니다.  이러한 하이퍼 스레딩 기술의 구현은 상대적인 칩 크기와 최대 전력 요구 사항에 5% 미만을 추가했지만, 그 이상의 성능 이점을 제공할 수 있습니다. 
각 논리 프로세서는 전체 아키텍처 상태 집합을 유지합니다.  아키텍처 상태는 범용 레지스터, 제어 레지스터, APIC(Advanced Programmable Interrupt Controller) 레지스터 및 일부 기계 상태 레지스터를 포함하는 레지스터로 구성됩니다.  소프트웨어 관점에서 아키텍처 상태가 복제되면 프로세서는 두 개의 프로세서로 나타납니다.  아키텍처 상태를 저장하는 트랜지스터의 수는 전체에서 극히 일부입니다.  논리 프로세서는 캐시와 같은 물리적 프로세서의 거의 모든 다른 리소스를 공유합니다. 
                                                          

 Intel은 미국 및 기타 국가에서 Intel Corporation 또는 해당 자회사의 등록 상표입니다. 

 Xeon은 미국 및 기타 국가에서 Intel Corporation 또는 해당 자회사의 상표입니다. 실행 단위, 분기 예측 변수, 제어 논리 및 버스의 세 가지 유형이 있습니다.   
각 논리 프로세서에는 고유한 인터럽트 컨트롤러 또는 APIC가 있습니다.  특정 논리 프로세서로 전송되는 인터럽트는 해당 논리 프로세서에 의해서만 처리됩니다.